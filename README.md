# 健康数据分析工具 v1.1

一个基于 Tkinter 的科研级健康数据分析工具，采用**严格的架构分离**设计，确保代码的健壮性和可扩展性。

## 🎯 核心特性

### 📊 强大的数据分析能力
- **直方图** (Histogram): 含核密度估计曲线，探索单变量分布
- **柱状图** (Bar Chart): 分类变量频数统计，连续变量自动分组
- **折线图** (Line Chart): 展示数据趋势变化
- **饼图** (Pie Chart): 分类变量占比可视化
- **Q-Q图** (Q-Q Plot): 检验数据是否符合正态分布
- **箱线图** (Box Plot): 分组比较，识别异常值
- **小提琴图** (Violin Plot): 显示分布的详细形状
- **描述性统计**: 计数、最小值、最大值、均值、中位数、标准差、四分位数等
- **t检验** (t-test): 独立样本t检验，判断两组是否有显著差异

### 🏗️ 优秀的架构设计
- **UI 与逻辑完全分离**: GUI 仅负责显示，所有分析由后端完成
- **数据驱动**: 自动检测连续型和分类型变量，动态生成界面选项
- **无状态绘图**: 每个图形都可独立保存、导出
- **中文友好**: 完全支持中文数据、标签和输出

## 📁 项目结构

```
健康数据分析工具/
├── main.py                    # GUI 主程序 (tkinter)
├── analysis_backend.py        # 数据分析后端 (pandas, seaborn, scipy)
├── requirements.txt           # 依赖列表
├── run.bat                    # 启动脚本 (Windows)
└── 题1-匿名健康数据.csv      # 示例数据
```

## ⚙️ 系统要求

- **Python** >= 3.8
- **操作系统**: Windows / macOS / Linux

## 📦 依赖安装

### 方法 1: 使用 requirements.txt (推荐)

```bash
pip install -r requirements.txt
```

### 方法 2: 手动安装

```bash
pip install pandas numpy matplotlib seaborn scipy
```

## 🚀 快速开始

### Windows 用户 (最简单)
双击 `run.bat` 文件即可启动应用。

### 所有平台 (命令行)

```bash
python main.py
```

## 📖 使用指南

### 第1步: 加载数据
1. 点击 "📁 加载CSV文件" 按钮
2. 选择你的 CSV 文件 (示例: `题1-匿名健康数据.csv`)
3. 程序会自动检测并分类所有变量

### 第2步: 选择变量
- **左侧面板 - 分类型变量**: 用于分组（X轴）
- **左侧面板 - 连续型变量**: 用于数值分析（Y轴）
- **取消选择**: 双击已选项或点击标题旁的"✕"按钮

### 第3步: 执行分析

#### 单变量分析 (只需选择Y)
- **📊 直方图**: 查看变量的分布形状
- **📉 折线图**: 展示数据趋势变化
- **📈 Q-Q图**: 检验正态性
- **📋 描述统计**: 查看计数、最小值、最大值、均值、中位数、标准差等

#### 分类变量专用 (选择X)
- **📊 柱状图**: 各类别频数统计
- **🥧 饼图**: 类别占比可视化

#### 双变量分析 (需选择X和Y)
- **📦 箱线图**: 按分类变量分组显示连续变量
- **🎻 小提琴图**: 更详细的分组分布展示
- **🔬 t检验**: 判断两组的差异是否显著 (p < 0.05)

### 第4步: 导出结果
- **💾 保存图形**: 将当前图形保存为 PNG 或 PDF
- **❌ 清空结果**: 清除统计输出

## 🔍 工作流程示例

### 案例: 分析性别与BMI的关系

1. 加载 `题1-匿名健康数据.csv`
2. 在左侧选择:
   - 分类型变量: `Sex` (性别)
   - 连续型变量: `BMI` (体质指数)
3. 点击 "📦 箱线图" → 观察性别之间的BMI差异
4. 点击 "🔬 t检验" → 获得统计学显著性结论 (p-value)
5. 点击 "💾 保存图形" → 导出为PNG供论文使用

## 📊 数据格式要求

你的 CSV 文件应符合以下格式:

```csv
Age,Sex,BMI,SBP,DBP,GLU,TC,LDL,HDL,TG
年龄,性别,身体质量指数,收缩压,舒张压,血糖,总胆固醇,低密度脂蛋白胆固醇,高密度脂蛋白胆固醇,甘油三酯
67,M,30.44,163,85.5,6.6,3.08,1.15,1.34,1.29
61,F,24.62,183,72.5,5.4,5.41,2.98,1.89,1.17
...
```

**支持的列类型:**
- **连续型**: 数值列，唯一值 > 10 (如 Age, BMI, SBP)
- **分类型**: 对象/字符列，或唯一值 ≤ 10 (如 Sex)

## 🛠️ 架构说明

### main.py (GUI 层)
```python
class App:
    - _load_csv()           # 加载数据文件
    - _draw_histogram()     # 绘制直方图
    - _draw_boxplot()       # 绘制箱线图
    - _run_t_test()         # 执行t检验
    - _embed_figure()       # 将matplotlib图嵌入tkinter
    - _save_plot()          # 导出图形
```

### analysis_backend.py (分析层)
```python
class DataAnalyzer:
    - load_data()           # 加载CSV，自动检测变量类型
    - get_descriptive_stats() # 描述统计（最小值、最大值、均值等）
    - plot_histogram()      # 绘制直方图
    - plot_bar()            # 绘制柱状图（智能区分连续/分类变量）
    - plot_line()           # 绘制折线图
    - plot_pie()            # 绘制饼图
    - plot_boxplot()        # 绘制箱线图
    - plot_qq()             # 绘制Q-Q图
    - plot_violin()         # 绘制小提琴图
    - run_t_test()          # 独立样本t检验
```

## 💡 设计优势

### 1. 健壮性 (Robustness)
- ✅ 严格的错误处理和异常捕获
- ✅ 数据验证（空值检查、类型转换）
- ✅ 中文编码完全支持（自动检测系统字体）
- ✅ 独立选择机制（exportselection=False）

### 2. 可扩展性 (Extensibility)
- ✅ 添加新分析方法只需修改 `analysis_backend.py`
- ✅ GUI 界面完全独立，不影响分析逻辑
- ✅ 易于添加新的绘图类型 (如热力图、相关性矩阵等)

### 3. 可测试性 (Testability)
- ✅ 后端可以在 Jupyter Notebook 中独立测试，无需启动GUI
- ✅ 每个分析方法都有清晰的输入/输出定义

### 4. 用户体验 (UX)
- ✅ 直观的标签页界面（绘图 vs 统计结果）
- ✅ 实时状态显示当前选择的变量
- ✅ 灵活的选择机制（支持双击取消、按钮清除）
- ✅ 记忆上次打开的文件目录
- ✅ 智能柱状图（自动识别连续/分类变量，使用不同样式）
- ✅ 清晰的错误提示和成功消息

## 🔬 科研应用建议

### 论文写作
```
1. 描述性统计 → 表1 (Mean ± SD)
2. 箱线图/小提琴图 → 图1 (可视化展示)
3. t检验 p-value → 结果段落 (显著性陈述)
4. 保存高分辨率图形 (PNG 300 dpi)
```

### 数据探索
```
1. 加载数据后，先查看 Q-Q 图判断正态性
2. 根据正态性选择参数/非参数检验
3. 对异常值进行箱线图检查
4. 使用直方图理解分布特征
```

## ❓ 常见问题 (FAQ)

### Q: 如何处理缺失值 (NaN)?
**A**: 程序自动跳过缺失值。如果需要更精细的处理，可编辑 `analysis_backend.py` 的 `load_data()` 方法。

### Q: 支持多少行数据?
**A**: 理论上无限制（受系统内存限制）。通常 10 万行以内性能无问题。

### Q: 如何添加新的统计检验?
**A**: 在 `analysis_backend.py` 中新增方法，例如：
```python
def run_anova(self, group_col, value_col):
    # 使用 scipy.stats.f_oneway() 实现
    pass
```
然后在 `main.py` 中添加对应按钮即可。

### Q: 能否处理日期/时间数据?
**A**: 目前不支持。如需要，可在 `_detect_column_types()` 中添加时间序列逻辑。

## 📝 更新日志

### v1.1 (2025-11-19)
- ✅ 新增折线图、柱状图、饼图
- ✅ 新增描述统计（包含最小值、最大值、均值等完整统计量）
- ✅ 优化选择机制：支持双击取消、按钮清除
- ✅ 实时状态显示当前选择的变量
- ✅ 记忆上次打开的CSV文件目录
- ✅ 智能柱状图：自动识别连续/分类变量，使用不同渲染方式
- ✅ 修复中文字体显示问题（自动检测系统可用字体）
- ✅ 修复选择互相干扰问题（exportselection=False）

### v1.0 (2024年)
- ✅ 初始版本发布
- ✅ 核心分析功能完成
- ✅ tkinter GUI 实现
- ✅ CSV 数据加载
- ✅ 自动变量分类
- ✅ 多种绘图类型
- ✅ t检验实现

## 👤 作者信息

**项目**: 健康数据分析工具  
**用途**: Python课程设计 / 科研数据分析  
**版本**: 1.0

## 📜 许可

本项目免费使用和修改。

## 🤝 贡献与反馈

欢迎提出改进建议！常见改进方向:
- [x] 柱状图 (已完成)
- [x] 折线图 (已完成)
- [x] 饼图 (已完成)
- [x] 完整描述统计 (已完成)
- [ ] ANOVA (多组检验)
- [ ] 相关性分析 (Pearson/Spearman)
- [ ] 散点图与回归线
- [ ] 热力图 (Heatmap)
- [ ] 配对t检验
- [ ] 非参数检验 (Mann-Whitney U)

---

**祝你的科研工作顺利！** 🎓
